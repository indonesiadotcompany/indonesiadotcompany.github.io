<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      All about kubernetes &middot; Blog Indonesiadot.Com
    
  </title>

  
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/poole.css">
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/syntax.css">
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.indonesiadot.com/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://blog.indonesiadot.com/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.indonesiadot.com/atom.xml">
</head>


  <body class="theme-base-0c">

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Blog dari <a href="https://indonesiadot.com" target="_blank">Indonesiadot.Com</a> adalah tempat menuliskan sesuatu mengenai teknologi, oprek, dan mengenai Indonesiadot.Com.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/">Home</a>
    <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/post">Posts</a>

    
    
      
        <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/about/">About</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/thanks/">Thanks</a>
      
    

  </nav>

  <div class="sidebar-item">
    <p>&copy; 2020. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://blog.indonesiadot.com/" title="Home">Blog Indonesiadot.Com</a>
            <small>Web log of Indonesiadot.Com, Linux and updated technology</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">All about kubernetes</h1>
  <span class="post-date">Sep 2, 2019</span>
  <h2 id="kubernetes-container-runtime-with-docker">Kubernetes Container runtime with docker</h2>
<pre><code># Install Docker CE
## Set up the repository
### Install required packages.
yum install yum-utils device-mapper-persistent-data lvm2

### Add Docker repository.
yum-config-manager \
  --add-repo \
  https://download.docker.com/linux/centos/docker-ce.repo

## Install Docker CE.
yum update &amp;&amp; yum install docker-ce-18.06.2.ce

## Create /etc/docker directory.
mkdir /etc/docker

# Setup daemon.
cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
{
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: {
    &quot;max-size&quot;: &quot;100m&quot;
  },
  &quot;storage-driver&quot;: &quot;overlay2&quot;,
  &quot;storage-opts&quot;: [
    &quot;overlay2.override_kernel_check=true&quot;
  ]
}
EOF

mkdir -p /etc/systemd/system/docker.service.d

# Restart Docker
</code></pre><p>systemctl daemon-reload
systemctl restart docker</p>
<pre><code>
* https://kubernetes.io/docs/setup/production-environment/container-runtimes/

## kubernetes master
</code></pre><p>hostnamectl set-hostname master-node
cat &laquo;EOF&raquo; /etc/hosts
10.128.0.27 master-node
10.128.0.29 node-1 worker-node-1
10.128.0.30 node-2 worker-node-2
EOF
setenforce 0
sed -i &ndash;follow-symlinks &lsquo;s/SELINUX=enforcing/SELINUX=disabled/g&rsquo; /etc/sysconfig/selinux
firewall-cmd &ndash;permanent &ndash;add-port=6443/tcp
firewall-cmd &ndash;permanent &ndash;add-port=2379-2380/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10250/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10251/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10252/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10255/tcp
firewall-cmd â€“reload</p>
<p>modprobe br_netfilter
cat &laquo;EOF&raquo; /etc/sysctl.d/100-kube.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl &ndash;system</p>
<p>cat &laquo;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg <a href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</a>
EOF
yum install kubeadm
systemctl enable kubelet
systemctl start kubelet</p>
<p>swapoff -a</p>
<p>kubeadm init &ndash;apiserver-advertise-address=192.168.122.42 &ndash;pod-network-cidr=10.244.0.0/16
mkdir -p $HOME/.kube</p>
<h1 id="cp--i-etckubernetesadminconf-homekubeconfig">cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</h1>
<h1 id="chown-id--uid--g-homekubeconfig">chown $(id -u):$(id -g) $HOME/.kube/config</h1>
<p>kubectl apply -f <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a>
kubectl get nodes</p>
<pre><code>
## kubernetes node

</code></pre><p>hostnamectl set-hostname &lsquo;node-1&rsquo;
cat &laquo;EOF&raquo; /etc/hosts
10.128.0.27 master-node
10.128.0.29 node-1 worker-node-1
10.128.0.30 node-2 worker-node-2
EOF</p>
<p>setenforce 0
sed -i &ndash;follow-symlinks &lsquo;s/SELINUX=enforcing/SELINUX=disabled/g&rsquo; /etc/sysconfig/selinux</p>
<p>firewall-cmd &ndash;permanent &ndash;add-port=6783/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10250/tcp
firewall-cmd &ndash;permanent &ndash;add-port=10255/tcp
firewall-cmd &ndash;permanent &ndash;add-port=30000-32767/tcp
firewall-cmd  &ndash;reload</p>
<p>cat &laquo;EOF&raquo; /etc/sysctl.d/100-kube.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl &ndash;system</p>
<p>cat &laquo;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg <a href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</a>
EOF</p>
<p>yum install kubeadm
systemctl enable kubelet
systemctl start kubelet</p>
<pre><code>
We now require the token that kubeadm init generated, to join the cluster. You can copy and paste it to your node-1 and node-2 if you had copied it somewhere.
</code></pre><p>kubeadm join 10.128.0.27:6443 &ndash;token nu06lu.xrsux0ss0ixtnms5  &ndash;discovery-token-ca-cert-hash sha256:f996ea3564e6a07fdea2997a1cf8caeddafd6d4360d606dbc82314688425cd41</p>
<pre><code>
## kubernetes master
</code></pre><p>kubectl get nodes</p>
<pre><code>
* https://www.tecmint.com/install-kubernetes-cluster-on-centos-7/
* https://www.howtoforge.com/tutorial/centos-kubernetes-docker-cluster/

## kubernetes kubeadm show join command

</code></pre><p>kubeadm token create &ndash;print-join-command</p>
<pre><code>
## kubernetes delete node
</code></pre><p>kubectl get nodes
kubectl drain <!-- raw HTML omitted -->
kubectl delete node <!-- raw HTML omitted --></p>
<pre><code>at the node, then type:
</code></pre><p>kubeadm reset</p>
<pre><code>
* https://stackoverflow.com/questions/35757620/how-to-gracefully-remove-a-node-from-kubernetes


</code></pre>
</div>

<hr/>


 Tags:
 <a href="https://blog.indonesiadot.com/tags/kubernetes/">kubernetes</a>, <a href="https://blog.indonesiadot.com/tags/container/">container</a>, <a href="https://blog.indonesiadot.com/tags/docker/">docker</a>
<hr/>
Made with &hearts; using <a href="https://https://gohugo.io">hugo</a> by willing of <a href="https://www.google.com/search?q=asmaul+husna">Al-Khooliq Al-Mushowwir Al-Baari'</a>
<p>&nbsp;</p>

	</div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  </body>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-147159427-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147159427-1');
</script>

</html>

