<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Ansible to Windows via winrm &middot; Blog Indonesiadot.Com
    
  </title>

  
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/poole.css">
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/syntax.css">
  <link rel="stylesheet" href="https://blog.indonesiadot.com/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.indonesiadot.com/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://blog.indonesiadot.com/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.indonesiadot.com/atom.xml">
</head>


  <body class="theme-base-0c">

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Blog dari <a href="https://indonesiadot.com" target="_blank">Indonesiadot.Com</a> adalah tempat menuliskan sesuatu mengenai teknologi, oprek, dan mengenai Indonesiadot.Com.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/">Home</a>
    
    <a class="sidebar-nav-item" href="https://blog.indonesiadot.com/post">Posts</a>
    <a class="sidebar-nav-item" href="https://blog.indonesiadot.com/tags">Tags</a>

    
    
      
        <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/about/">About</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item " href="https://blog.indonesiadot.com/thanks/">Thanks</a>
      
    

  </nav>

  <div class="sidebar-item">
    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://blog.indonesiadot.com/" title="Home">Blog Indonesiadot.Com</a>
            <small>Web log of Indonesiadot.Com, Linux and updated technology</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">Ansible to Windows via winrm</h1>
  <span class="post-date">Jun 24, 2020</span>
  

<h2 id="prerequisites-on-windows">Prerequisites on windows</h2>

<h3 id="upgrading-powershell-and-net-framework">Upgrading PowerShell and .NET Framework</h3>

<p><a href="https://docs.ansible.com/ansible/latest/user_guide/windows_setup.html">https://docs.ansible.com/ansible/latest/user_guide/windows_setup.html</a></p>

<p>Buka powershell sebagai administrator, lalu copy paste bagian berikut:</p>

<pre><code>$url = &quot;https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Upgrade-PowerShell.ps1&quot;
$file = &quot;$env:temp\Upgrade-PowerShell.ps1&quot;
$username = &quot;Administrator&quot;
$password = &quot;Password&quot;

(New-Object -TypeName System.Net.WebClient).DownloadFile($url, $file)
Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force

# Version can be 3.0, 4.0 or 5.1
&amp;$file -Version 5.1 -Username $username -Password $password -Verbose
</code></pre>

<p>Once completed, you will need to remove auto logon and set the execution policy back to the default of Restricted. You can do this with the following PowerShell commands:</p>

<pre><code># This isn't needed but is a good security practice to complete
Set-ExecutionPolicy -ExecutionPolicy Restricted -Force

$reg_winlogon_path = &quot;HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;
Set-ItemProperty -Path $reg_winlogon_path -Name AutoAdminLogon -Value 0
Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultUserName -ErrorAction SilentlyContinue
Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultPassword -ErrorAction SilentlyContinue
</code></pre>

<h3 id="windows-preparation">Windows preparation</h3>

<p><a href="https://medium.com/the-sysadmin/managing-windows-machines-with-ansible-60395445069f">https://medium.com/the-sysadmin/managing-windows-machines-with-ansible-60395445069f</a></p>

<p>Buka cmd (command prompt) sebagai administrator, lalu copy paste bagian berikut:</p>

<pre><code>@powershell -NoProfile -ExecutionPolicy Bypass -Command &quot;iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1'))&quot;
</code></pre>

<h3 id="prerequisites-di-sisi-ansible-engine">Prerequisites di sisi ansible engine</h3>

<p><a href="https://stackoverflow.com/questions/51633907/msg-winrm-or-requests-is-not-installed-no-module-named-xmltodict">https://stackoverflow.com/questions/51633907/msg-winrm-or-requests-is-not-installed-no-module-named-xmltodict</a></p>

<pre><code>pip install --ignore-installed pywinrm
</code></pre>

<h3 id="inventory-ansible">inventory ansible</h3>

<p><a href="https://geekflare.com/connecting-windows-ansible-from-ubuntu/">https://geekflare.com/connecting-windows-ansible-from-ubuntu/</a></p>

<pre><code>[windows]
10.11.8.102 ansible_user=ansible ansible_password=pwdansibl3 ansible_winrm_port=5986 ansible_connection=winrm ansible_winrm_server_cert_validation=ignore
</code></pre>

<h3 id="test-it">test it</h3>

<pre><code>ansible windows -m win_ping
</code></pre>

<h3 id="note">note</h3>

<pre><code>ansible.cfg
[defaults]
inventory = ./inventory
</code></pre>

<h3 id="win-chocolatey-untuk-install-aplikasi">win chocolatey untuk install aplikasi</h3>

<p><a href="https://chocolatey.org/docs/installation">https://chocolatey.org/docs/installation</a></p>

<p>install terlebih dahulu chocolatey di windows dengan command:</p>

<pre><code>@&quot;%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot; [System.Net.ServicePointManager]::SecurityProtocol = 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))&quot; &amp;&amp; SET &quot;PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin&quot;
</code></pre>

<p>lalu test install beberapa aplikasi dengan ansible ad-hoc command:</p>

<pre><code>ansible windows -m win_chocolatey -a &quot;name=putty state=present&quot;
ansible windows -m win_chocolatey -a &quot;name=git state=present&quot;
ansible windows -m win_chocolatey -a &quot;name=7zip state=present&quot;
</code></pre>

<p>Referensi:</p>

<ul>
<li><a href="https://github.com/jborean93/ansible-windows/tree/master/scripts">https://github.com/jborean93/ansible-windows/tree/master/scripts</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/list_of_windows_modules.html">https://docs.ansible.com/ansible/latest/modules/list_of_windows_modules.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/win_chocolatey_module.html#win-chocolatey-module">https://docs.ansible.com/ansible/latest/modules/win_chocolatey_module.html#win-chocolatey-module</a></li>
</ul>

</div>

<hr/>


 Tags:
 <a href="https://blog.indonesiadot.com/tags/linux/">linux</a>, <a href="https://blog.indonesiadot.com/tags/ansible/">ansible</a>, <a href="https://blog.indonesiadot.com/tags/windows/">windows</a>, <a href="https://blog.indonesiadot.com/tags/winrm/">winrm</a>
<hr/>
Made with &hearts; using <a href="https://https://gohugo.io">hugo</a> by willing of <a href="https://www.google.com/search?q=asmaul+husna">Al-Khooliq Al-Mushowwir Al-Baari'</a>
<p>&nbsp;</p>

	</div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  </body>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-147159427-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147159427-1');
</script>

</html>

